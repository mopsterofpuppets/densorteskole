<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<title>Den Sorte Skole – Lobby</title>
<link href="https://fonts.googleapis.com/css2?family=Metal+Mania&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="firebase_c.js"></script>

<style>
body {
  margin:0; background:black; color:white;
  font-family:'Metal Mania', cursive;
  text-align:center;
  background:url('background.jpg') no-repeat center center fixed;
  background-size:cover;
  position: relative;
}

/* Dark overlay */
body::before {
  content: "";
  position: fixed;
  top:0; left:0;
  width:100%; height:100%;
  background: rgba(0,0,0,0.6); /* 60% mørkt overlay */
  z-index: -1; 
}

h1 {
  font-size:5em; margin:20px 0; color:#ff0000;
  text-shadow:
     0 0 5px #660000,
     0 0 10px #990000,
     0 0 20px #cc0000,
     0 0 30px #ff0000,
     0 0 40px #ff3300,
     0 0 50px #ff3300,
     0 0 60px #ff6600;
}
h2 { font-size:2em; margin-top:10px; }
ul { list-style:none; padding:0; margin:0; }
li { margin:5px 0; font-size:1.5em; }
button {
  background:darkred; color:white; font-size:1.5em;
  padding:10px 20px; border:none; cursor:pointer;
  margin:20px; border-radius:10px; box-shadow:0 0 15px red;
}
button:hover { background:#b30000; }
</style>
</head>
<body>
<h1>Den Sorte Skole</h1>

<canvas id="qrCode"></canvas>
<p>Scan QR-koden for at tilmelde et hold</p>

<h2 id="holdHeader" style="display:none;">Hold</h2>
<ul id="teamList"></ul>

<button id="startGameBtn">Start spil</button>

<script>
// Generer unikt spil-ID
let gameId = 'game_' + Date.now();
localStorage.setItem("gameId", gameId);

// Nulstil alle data for dette spil
db.ref(gameId).set({
  teams: null,
  buzz: { buzzed:false, team:null, teamId:null },
  buzzLocked: false,
  gameStarted: false,
  questionOpen: false
});

// Lav QR-kode til join.htm med spil-ID og korrekt sti
new QRious({
  element: document.getElementById('qrCode'),
  value: window.location.origin + location.pathname.replace("index.htm","") + 'join.htm?game=' + gameId,
  size: 200
});

// Holdliste og dynamisk header
const teamList = document.getElementById('teamList');
const holdHeader = document.getElementById('holdHeader');

db.ref(gameId + "/teams").on('value', snap=>{
  teamList.innerHTML='';
  if(snap.exists()){
    holdHeader.style.display="block";
    snap.forEach(child=>{
      const t = child.val();
      const li = document.createElement('li');
      li.textContent = `${t.name} — ${t.points || 0} point`;
      teamList.appendChild(li);
    });
  } else {
    holdHeader.style.display="none";
  }
});

// Start spil → redirect til game.htm
document.getElementById('startGameBtn').addEventListener('click', ()=>{
  db.ref(gameId + "/gameStarted").set(true);
  window.location.href="game.htm?game=" + gameId;
});
</script>
</body>
</html>
